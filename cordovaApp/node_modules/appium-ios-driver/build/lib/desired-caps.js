'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _logger = require('./logger');

var _logger2 = _interopRequireDefault(_logger);

var desiredCapConstraints = {
  platformName: {
    presence: true,
    isString: true,
    inclusionCaseInsensitive: ['iOS']
  },
  browserName: {
    isString: true
  },
  app: {
    isString: true
  },

  launchTimeout: {
    // recognize the cap,
    // but validate in the driver#validateDesiredCaps method
  },
  calendarFormat: {
    isString: true
  },
  bundleId: {
    isString: true
  },
  udid: {
    isString: true
  },
  locationServicesEnabled: {
    isBoolean: true
  },
  locationServicesAuthorized: {
    isBoolean: true
  },
  autoAcceptAlerts: {
    isBoolean: true
  },
  autoDismissAlerts: {
    isBoolean: true
  },
  nativeInstrumentsLib: {
    isBoolean: true
  },
  nativeWebTap: {
    isBoolean: true
  },
  safariInitialUrl: {
    isString: true
  },
  safariAllowPopups: {
    isBoolean: true
  },
  safariIgnoreFraudWarning: {
    isBoolean: true
  },
  safariOpenLinksInBackground: {
    isBoolean: true
  },
  keepKeyChains: {
    isBoolean: true
  },
  localizableStringsDir: {
    isString: true
  },
  processArguments: {
    // recognize the cap,
    // but validate in the driver#validateDesiredCaps method
  },
  interKeyDelay: {
    isNumber: true
  },
  showIOSLog: {
    isBoolean: true
  },
  sendKeyStrategy: {
    isString: true,
    inclusion: ['oneByOne', 'grouped', 'setValue']
  },
  screenshotWaitTimeout: {
    isNumber: true
  },
  waitForAppScript: {
    isString: true
  },
  webviewConnectRetries: {
    isNumber: true
  },
  appName: {
    isString: true
  },
  clearSystemFiles: {
    isBoolean: true
  }
};

function desiredCapValidation(caps) {
  // make sure that the capabilities have one of `app` or `bundleId`
  if ((caps.browserName || '').toLowerCase() !== 'safari' && !caps.app && !caps.bundleId) {
    var msg = 'The desired capabilities must include either an app or a bundleId for iOS';
    _logger2['default'].errorAndThrow(msg);
  }

  // `launchTimeout` is more complex than the validators can easily handle
  // and too specific for a generalized validator of its own
  if (caps.launchTimeout) {
    // it can be a number, a JSON string, or an object
    var msg = 'launchTimeout must be a number, object, or string JSON object';
    if (!_lodash2['default'].isNumber(caps.launchTimeout)) {
      if (_lodash2['default'].isString(caps.launchTimeout)) {
        // if this is a string, it must be a JSON string
        try {
          // change `launchTimeout` to an object
          caps.launchTimeout = JSON.parse(caps.launchTimeout);
        } catch (err) {
          // it was a string, but not something parsable as JSON
          _logger2['default'].errorAndThrow(msg);
        }
      }
      if (!_lodash2['default'].isObject(caps.launchTimeout)) {
        _logger2['default'].errorAndThrow(msg);
      }
    }
  }

  // `processArguments` is more complex as it can be a string
  // or a hash
  if (caps.processArguments) {
    if (_lodash2['default'].isString(caps.processArguments)) {
      try {
        // try to parse the string as JSON
        caps.processArguments = JSON.parse(caps.processArguments);
      } catch (ign) {
        // if we cannot parse, just leave as a string
      }
    } else if (!_lodash2['default'].isObject(caps.processArguments)) {
        _logger2['default'].errorAndThrow('processArguments must be a string, object, or a string JSON object');
      }
  }

  // finally, return true since the superclass check passed, as did this
  return true;
}

exports.desiredCapConstraints = desiredCapConstraints;
exports.desiredCapValidation = desiredCapValidation;
exports['default'] = desiredCapConstraints;
//# sourceMappingURL=data:application/json;base64,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OztBQUVsQyxZQUFJOztBQUVGLGNBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7U0FDckQsQ0FBQyxPQUFPLEdBQUcsRUFBRTs7QUFFWiw4QkFBTyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDM0I7T0FDRjtBQUNELFVBQUksQ0FBQyxvQkFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFO0FBQ25DLDRCQUFPLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztPQUMzQjtLQUNGO0dBQ0Y7Ozs7QUFJRCxNQUFJLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtBQUN6QixRQUFJLG9CQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRTtBQUNyQyxVQUFJOztBQUVGLFlBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO09BQzNELENBQUMsT0FBTyxHQUFHLEVBQUU7O09BRWI7S0FDRixNQUFNLElBQUksQ0FBQyxvQkFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEVBQUU7QUFDN0MsNEJBQU8sYUFBYSxDQUFDLG9FQUFvRSxDQUFDLENBQUM7T0FDNUY7R0FDRjs7O0FBR0QsU0FBTyxJQUFJLENBQUM7Q0FDYjs7UUFFUSxxQkFBcUIsR0FBckIscUJBQXFCO1FBQUUsb0JBQW9CLEdBQXBCLG9CQUFvQjtxQkFDckMscUJBQXFCIiwiZmlsZSI6ImxpYi9kZXNpcmVkLWNhcHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5cblxuY29uc3QgZGVzaXJlZENhcENvbnN0cmFpbnRzID0ge1xuICBwbGF0Zm9ybU5hbWU6IHtcbiAgICBwcmVzZW5jZTogdHJ1ZSxcbiAgICBpc1N0cmluZzogdHJ1ZSxcbiAgICBpbmNsdXNpb25DYXNlSW5zZW5zaXRpdmU6IFsnaU9TJ11cbiAgfSxcbiAgYnJvd3Nlck5hbWU6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBhcHA6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuXG4gIGxhdW5jaFRpbWVvdXQ6IHtcbiAgICAvLyByZWNvZ25pemUgdGhlIGNhcCxcbiAgICAvLyBidXQgdmFsaWRhdGUgaW4gdGhlIGRyaXZlciN2YWxpZGF0ZURlc2lyZWRDYXBzIG1ldGhvZFxuICB9LFxuICBjYWxlbmRhckZvcm1hdDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGJ1bmRsZUlkOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgdWRpZDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGxvY2F0aW9uU2VydmljZXNFbmFibGVkOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGxvY2F0aW9uU2VydmljZXNBdXRob3JpemVkOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGF1dG9BY2NlcHRBbGVydHM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgYXV0b0Rpc21pc3NBbGVydHM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgbmF0aXZlSW5zdHJ1bWVudHNMaWI6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgbmF0aXZlV2ViVGFwOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNhZmFyaUluaXRpYWxVcmw6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBzYWZhcmlBbGxvd1BvcHVwczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzYWZhcmlJZ25vcmVGcmF1ZFdhcm5pbmc6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2FmYXJpT3BlbkxpbmtzSW5CYWNrZ3JvdW5kOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGtlZXBLZXlDaGFpbnM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgbG9jYWxpemFibGVTdHJpbmdzRGlyOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgcHJvY2Vzc0FyZ3VtZW50czoge1xuICAgIC8vIHJlY29nbml6ZSB0aGUgY2FwLFxuICAgIC8vIGJ1dCB2YWxpZGF0ZSBpbiB0aGUgZHJpdmVyI3ZhbGlkYXRlRGVzaXJlZENhcHMgbWV0aG9kXG4gIH0sXG4gIGludGVyS2V5RGVsYXk6IHtcbiAgICBpc051bWJlcjogdHJ1ZVxuICB9LFxuICBzaG93SU9TTG9nOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNlbmRLZXlTdHJhdGVneToge1xuICAgIGlzU3RyaW5nOiB0cnVlLFxuICAgIGluY2x1c2lvbjogWydvbmVCeU9uZScsICdncm91cGVkJywgJ3NldFZhbHVlJ11cbiAgfSxcbiAgc2NyZWVuc2hvdFdhaXRUaW1lb3V0OiB7XG4gICAgaXNOdW1iZXI6IHRydWVcbiAgfSxcbiAgd2FpdEZvckFwcFNjcmlwdDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHdlYnZpZXdDb25uZWN0UmV0cmllczoge1xuICAgIGlzTnVtYmVyOiB0cnVlXG4gIH0sXG4gIGFwcE5hbWU6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBjbGVhclN5c3RlbUZpbGVzOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG59O1xuXG5mdW5jdGlvbiBkZXNpcmVkQ2FwVmFsaWRhdGlvbiAoY2Fwcykge1xuICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgY2FwYWJpbGl0aWVzIGhhdmUgb25lIG9mIGBhcHBgIG9yIGBidW5kbGVJZGBcbiAgaWYgKChjYXBzLmJyb3dzZXJOYW1lIHx8ICcnKS50b0xvd2VyQ2FzZSgpICE9PSAnc2FmYXJpJyAmJlxuICAgICAgIWNhcHMuYXBwICYmICEgY2Fwcy5idW5kbGVJZCkge1xuICAgIGxldCBtc2cgPSAnVGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzIG11c3QgaW5jbHVkZSBlaXRoZXIgYW4gYXBwIG9yIGEgYnVuZGxlSWQgZm9yIGlPUyc7XG4gICAgbG9nZ2VyLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgfVxuXG4gIC8vIGBsYXVuY2hUaW1lb3V0YCBpcyBtb3JlIGNvbXBsZXggdGhhbiB0aGUgdmFsaWRhdG9ycyBjYW4gZWFzaWx5IGhhbmRsZVxuICAvLyBhbmQgdG9vIHNwZWNpZmljIGZvciBhIGdlbmVyYWxpemVkIHZhbGlkYXRvciBvZiBpdHMgb3duXG4gIGlmIChjYXBzLmxhdW5jaFRpbWVvdXQpIHtcbiAgICAvLyBpdCBjYW4gYmUgYSBudW1iZXIsIGEgSlNPTiBzdHJpbmcsIG9yIGFuIG9iamVjdFxuICAgIGxldCBtc2cgPSAnbGF1bmNoVGltZW91dCBtdXN0IGJlIGEgbnVtYmVyLCBvYmplY3QsIG9yIHN0cmluZyBKU09OIG9iamVjdCc7XG4gICAgaWYgKCFfLmlzTnVtYmVyKGNhcHMubGF1bmNoVGltZW91dCkpIHtcbiAgICAgIGlmIChfLmlzU3RyaW5nKGNhcHMubGF1bmNoVGltZW91dCkpIHtcbiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIHN0cmluZywgaXQgbXVzdCBiZSBhIEpTT04gc3RyaW5nXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gY2hhbmdlIGBsYXVuY2hUaW1lb3V0YCB0byBhbiBvYmplY3RcbiAgICAgICAgICBjYXBzLmxhdW5jaFRpbWVvdXQgPSBKU09OLnBhcnNlKGNhcHMubGF1bmNoVGltZW91dCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vIGl0IHdhcyBhIHN0cmluZywgYnV0IG5vdCBzb21ldGhpbmcgcGFyc2FibGUgYXMgSlNPTlxuICAgICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghXy5pc09iamVjdChjYXBzLmxhdW5jaFRpbWVvdXQpKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gYHByb2Nlc3NBcmd1bWVudHNgIGlzIG1vcmUgY29tcGxleCBhcyBpdCBjYW4gYmUgYSBzdHJpbmdcbiAgLy8gb3IgYSBoYXNoXG4gIGlmIChjYXBzLnByb2Nlc3NBcmd1bWVudHMpIHtcbiAgICBpZiAoXy5pc1N0cmluZyhjYXBzLnByb2Nlc3NBcmd1bWVudHMpKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyB0cnkgdG8gcGFyc2UgdGhlIHN0cmluZyBhcyBKU09OXG4gICAgICAgIGNhcHMucHJvY2Vzc0FyZ3VtZW50cyA9IEpTT04ucGFyc2UoY2Fwcy5wcm9jZXNzQXJndW1lbnRzKTtcbiAgICAgIH0gY2F0Y2ggKGlnbikge1xuICAgICAgICAvLyBpZiB3ZSBjYW5ub3QgcGFyc2UsIGp1c3QgbGVhdmUgYXMgYSBzdHJpbmdcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFfLmlzT2JqZWN0KGNhcHMucHJvY2Vzc0FyZ3VtZW50cykpIHtcbiAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdwcm9jZXNzQXJndW1lbnRzIG11c3QgYmUgYSBzdHJpbmcsIG9iamVjdCwgb3IgYSBzdHJpbmcgSlNPTiBvYmplY3QnKTtcbiAgICB9XG4gIH1cblxuICAvLyBmaW5hbGx5LCByZXR1cm4gdHJ1ZSBzaW5jZSB0aGUgc3VwZXJjbGFzcyBjaGVjayBwYXNzZWQsIGFzIGRpZCB0aGlzXG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgeyBkZXNpcmVkQ2FwQ29uc3RyYWludHMsIGRlc2lyZWRDYXBWYWxpZGF0aW9uIH07XG5leHBvcnQgZGVmYXVsdCBkZXNpcmVkQ2FwQ29uc3RyYWludHM7XG4iXX0=