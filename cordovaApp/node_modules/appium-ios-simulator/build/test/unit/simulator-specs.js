require('source-map-support').install();

'use strict';

var _Promise = require('babel-runtime/core-js/promise')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _this = this;

var _ = require('../..');

var _libSimulatorXcode6 = require('../../lib/simulator-xcode-6');

var _libSimulatorXcode62 = _interopRequireDefault(_libSimulatorXcode6);

var _libSimulatorXcode7 = require('../../lib/simulator-xcode-7');

var _libSimulatorXcode72 = _interopRequireDefault(_libSimulatorXcode7);

var _nodeSimctl = require('node-simctl');

var simctl = _interopRequireWildcard(_nodeSimctl);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _assetsDeviceList = require('../assets/deviceList');

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _appiumXcode = require('appium-xcode');

var _appiumXcode2 = _interopRequireDefault(_appiumXcode);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var UDID = _assetsDeviceList.devices['7.1'][0].udid;

describe('simulator', function () {
  var xcodeMock = undefined;
  var getDevicesStub = undefined;

  beforeEach(function () {
    xcodeMock = _sinon2['default'].mock(_appiumXcode2['default']);
    getDevicesStub = _sinon2['default'].stub(simctl, 'getDevices');
    getDevicesStub.returns(_Promise.resolve(_assetsDeviceList.devices));
  });
  afterEach(function () {
    xcodeMock.restore();
    simctl.getDevices.restore();
  });

  describe('getSimulator', function () {
    it('should create a simulator with default xcode version', function callee$2$0() {
      var xcodeVersion, sim;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeVersion = { major: 6, versionString: '6.0.0' };

            xcodeMock.expects('getVersion').returns(_Promise.resolve(xcodeVersion));

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(UDID));

          case 4:
            sim = context$3$0.sent;

            sim.xcodeVersion.should.equal(xcodeVersion);
            sim.should.be.an['instanceof'](_libSimulatorXcode62['default']);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should create an xcode 7 simulator with xcode version 7', function callee$2$0() {
      var xcodeVersion, sim;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeVersion = { major: 7, versionString: '7.0.0' };

            xcodeMock.expects('getVersion').returns(_Promise.resolve(xcodeVersion));

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(UDID));

          case 4:
            sim = context$3$0.sent;

            sim.xcodeVersion.should.equal(xcodeVersion);
            sim.should.be.an['instanceof'](_libSimulatorXcode72['default']);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should throw an error if xcode version less than 6', function callee$2$0() {
      var xcodeVersion;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeVersion = { major: 5, versionString: '5.4.0' };

            xcodeMock.expects('getVersion').returns(_Promise.resolve(xcodeVersion));

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(UDID).should.eventually.be.rejectedWith('version'));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should throw an error if xcode version above 8', function callee$2$0() {
      var xcodeVersion;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeVersion = { major: 9, versionString: '9.0.0' };

            xcodeMock.expects('getVersion').returns(_Promise.resolve(xcodeVersion));

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(UDID).should.eventually.be.rejectedWith('not yet'));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should throw an error if udid does not exist', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)('123').should.be.rejectedWith('No sim found'));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should list stats for sim', function callee$2$0() {
      var xcodeVersion, sims, stats;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeVersion = { major: 6, versionString: '6.0.0' };

            xcodeMock.expects('getVersion').atLeast(1).returns(_Promise.resolve(xcodeVersion));

            sims = [(0, _.getSimulator)('F33783B2-9EE9-4A99-866E-E126ADBAD410'), (0, _.getSimulator)('DFBC2970-9455-4FD9-BB62-9E4AE5AA6954')];
            stats = sims.map(function (simProm) {
              return simProm.then(function (sim) {
                return sim.stat();
              });
            });
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_bluebird2['default'].all(stats));

          case 6:
            stats = context$3$0.sent;

            stats[0].state.should.equal('Shutdown');
            stats[0].name.should.equal('Resizable iPhone');
            stats[1].state.should.equal('Shutdown');
            stats[1].name.should.equal('Resizable iPad');

          case 11:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('getDeviceString', function () {
    describe('Xcode 6', function () {
      var xcodeVersion = { major: 6, versionString: '6.0.0' };

      beforeEach(function () {
        xcodeMock.expects('getVersion').returns(_Promise.resolve(xcodeVersion));
      });

      it('should get the correct device for iOS 8+', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve(8.4));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)());

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.4 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 8+ when platform version passed in', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ platformVersion: '8.1' }));

            case 2:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.1 Simulator)');

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 7+', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve(7.1));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)());

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 5s (7.1 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 7+ when platform version passed in', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ platformVersion: '7.1' }));

            case 2:
              device = context$4$0.sent;

              device.should.equal('iPhone 5s (7.1 Simulator)');

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should pass through device name when passed with =', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve(8.4));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: '=fancy device' }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('fancy device');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should add a device name when passed without =', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve(8.4));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: 'fancy device' }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('fancy device (8.4 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should handle string platform version', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve('8.4'));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)());

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.4 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should strip " Simulator" when not necessary', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve('8.4'));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: "iPhone 6 Simulator" }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.4 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should handle bare "iPhone"', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve('8.4'));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: "iPhone" }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.4 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });

    describe('Xcode 7', function () {
      var xcodeVersion = { major: 7, versionString: '7.0.0' };

      beforeEach(function () {
        xcodeMock.expects('getVersion').returns(_Promise.resolve(xcodeVersion));
      });

      it('should get the correct device for iOS 8+', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve(8.4));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)());

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.4)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 8+ when platform version passed in', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(_libSimulatorXcode72['default'].getDeviceString({ platformVersion: '8.1' }));

            case 2:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.1)');

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 9+', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve(9));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)());

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (9.0) [');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 9+ when platform version passed in', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ platformVersion: '9.0' }));

            case 2:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (9.0) [');

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should pass through device name when passed with =', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve(9.0));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: '=fancy device' }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('fancy device');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should add a device name when passed without =', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve(9.0));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: 'fancy device' }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('fancy device (9.0)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should strip " Simulator" when not necessary', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve('9.0'));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: "iPhone 6 Simulator" }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (9.0) [');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should handle bare "iPhone"', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_Promise.resolve('9.0'));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: "iPhone" }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (9.0) [');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9zaW11bGF0b3Itc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Z0JBRThDLE9BQU87O2tDQUN6Qiw2QkFBNkI7Ozs7a0NBQzdCLDZCQUE2Qjs7OzswQkFDakMsYUFBYTs7SUFBekIsTUFBTTs7b0JBQ0QsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7cUJBQzNCLE9BQU87Ozs7Z0NBQ0Qsc0JBQXNCOzt3QkFDaEMsVUFBVTs7OzsyQkFDTixjQUFjOzs7O0FBR2hDLGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsSUFBTSxJQUFJLEdBQUcsMEJBQVEsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDOztBQUVwQyxRQUFRLENBQUMsV0FBVyxFQUFFLFlBQU07QUFDMUIsTUFBSSxTQUFTLFlBQUEsQ0FBQztBQUNkLE1BQUksY0FBYyxZQUFBLENBQUM7O0FBRW5CLFlBQVUsQ0FBQyxZQUFNO0FBQ2YsYUFBUyxHQUFHLG1CQUFNLElBQUksMEJBQU8sQ0FBQztBQUM5QixrQkFBYyxHQUFHLG1CQUFNLElBQUksQ0FBQyxNQUFNLEVBQUUsWUFBWSxDQUFDLENBQUM7QUFDbEQsa0JBQWMsQ0FBQyxPQUFPLENBQUMsU0FBUSxPQUFPLDJCQUFTLENBQUMsQ0FBQztHQUNsRCxDQUFDLENBQUM7QUFDSCxXQUFTLENBQUMsWUFBTTtBQUNkLGFBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUNwQixVQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDO0dBQzdCLENBQUMsQ0FBQzs7QUFFSCxVQUFRLENBQUMsY0FBYyxFQUFFLFlBQU07QUFDN0IsTUFBRSxDQUFDLHNEQUFzRCxFQUFFO1VBQ3JELFlBQVksRUFHWixHQUFHOzs7O0FBSEgsd0JBQVksR0FBRyxFQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsYUFBYSxFQUFFLE9BQU8sRUFBQzs7QUFD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LEVBQUMsVUFBVSxFQUFFLG9CQUFvQixFQUFDLENBQUM7OztBQUFsRSxvQkFBTTs7QUFDVixvQkFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQzs7Ozs7OztPQUN6QyxDQUFDLENBQUM7QUFDSCxRQUFFLENBQUMsNkJBQTZCLEVBQUU7WUFFNUIsTUFBTTs7OztBQURWLHVCQUFTLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFRLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDOzsrQ0FDL0MsdUJBQWdCLEVBQUMsVUFBVSxFQUFFLFFBQVEsRUFBQyxDQUFDOzs7QUFBdEQsb0JBQU07O0FBQ1Ysb0JBQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7Ozs7Ozs7T0FDekMsQ0FBQyxDQUFDO0tBQ0osQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvdW5pdC9zaW11bGF0b3Itc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IHsgZ2V0U2ltdWxhdG9yLCBnZXREZXZpY2VTdHJpbmcgfSBmcm9tICcuLi8uLic7XG5pbXBvcnQgU2ltdWxhdG9yWGNvZGU2IGZyb20gJy4uLy4uL2xpYi9zaW11bGF0b3IteGNvZGUtNic7XG5pbXBvcnQgU2ltdWxhdG9yWGNvZGU3IGZyb20gJy4uLy4uL2xpYi9zaW11bGF0b3IteGNvZGUtNyc7XG5pbXBvcnQgKiBhcyBzaW1jdGwgZnJvbSAnbm9kZS1zaW1jdGwnO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IHsgZGV2aWNlcyB9IGZyb20gJy4uL2Fzc2V0cy9kZXZpY2VMaXN0JztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB4Y29kZSBmcm9tICdhcHBpdW0teGNvZGUnO1xuXG5cbmNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cbmNvbnN0IFVESUQgPSBkZXZpY2VzWyc3LjEnXVswXS51ZGlkO1xuXG5kZXNjcmliZSgnc2ltdWxhdG9yJywgKCkgPT4ge1xuICBsZXQgeGNvZGVNb2NrO1xuICBsZXQgZ2V0RGV2aWNlc1N0dWI7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgeGNvZGVNb2NrID0gc2lub24ubW9jayh4Y29kZSk7XG4gICAgZ2V0RGV2aWNlc1N0dWIgPSBzaW5vbi5zdHViKHNpbWN0bCwgJ2dldERldmljZXMnKTtcbiAgICBnZXREZXZpY2VzU3R1Yi5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShkZXZpY2VzKSk7XG4gIH0pO1xuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIHhjb2RlTW9jay5yZXN0b3JlKCk7XG4gICAgc2ltY3RsLmdldERldmljZXMucmVzdG9yZSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U2ltdWxhdG9yJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgc2ltdWxhdG9yIHdpdGggZGVmYXVsdCB4Y29kZSB2ZXJzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHhjb2RlVmVyc2lvbiA9IHttYWpvcjogNiwgdmVyc2lvblN0cmluZzogJzYuMC4wJ307XG4gICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0VmVyc2lvbicpLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHhjb2RlVmVyc2lvbikpO1xuXG4gICAgICBsZXQgc2ltID0gYXdhaXQgZ2V0U2ltdWxhdG9yKFVESUQpO1xuICAgICAgc2ltLnhjb2RlVmVyc2lvbi5zaG91bGQuZXF1YWwoeGNvZGVWZXJzaW9uKTtcbiAgICAgIHNpbS5zaG91bGQuYmUuYW4uaW5zdGFuY2VvZihTaW11bGF0b3JYY29kZTYpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW4geGNvZGUgNyBzaW11bGF0b3Igd2l0aCB4Y29kZSB2ZXJzaW9uIDcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgeGNvZGVWZXJzaW9uID0ge21ham9yOiA3LCB2ZXJzaW9uU3RyaW5nOiAnNy4wLjAnfTtcbiAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRWZXJzaW9uJykucmV0dXJucyhQcm9taXNlLnJlc29sdmUoeGNvZGVWZXJzaW9uKSk7XG5cbiAgICAgIGxldCBzaW0gPSBhd2FpdCBnZXRTaW11bGF0b3IoVURJRCk7XG4gICAgICBzaW0ueGNvZGVWZXJzaW9uLnNob3VsZC5lcXVhbCh4Y29kZVZlcnNpb24pO1xuICAgICAgc2ltLnNob3VsZC5iZS5hbi5pbnN0YW5jZW9mKFNpbXVsYXRvclhjb2RlNyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIGlmIHhjb2RlIHZlcnNpb24gbGVzcyB0aGFuIDYnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgeGNvZGVWZXJzaW9uID0ge21ham9yOiA1LCB2ZXJzaW9uU3RyaW5nOiAnNS40LjAnfTtcbiAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRWZXJzaW9uJykucmV0dXJucyhQcm9taXNlLnJlc29sdmUoeGNvZGVWZXJzaW9uKSk7XG5cbiAgICAgIGF3YWl0IGdldFNpbXVsYXRvcihVRElEKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoJ3ZlcnNpb24nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3IgaWYgeGNvZGUgdmVyc2lvbiBhYm92ZSA4JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHhjb2RlVmVyc2lvbiA9IHttYWpvcjogOSwgdmVyc2lvblN0cmluZzogJzkuMC4wJ307XG4gICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0VmVyc2lvbicpLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHhjb2RlVmVyc2lvbikpO1xuXG4gICAgICBhd2FpdCBnZXRTaW11bGF0b3IoVURJRCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKCdub3QgeWV0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIGlmIHVkaWQgZG9lcyBub3QgZXhpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBnZXRTaW11bGF0b3IoJzEyMycpLnNob3VsZC5iZS5yZWplY3RlZFdpdGgoJ05vIHNpbSBmb3VuZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsaXN0IHN0YXRzIGZvciBzaW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgeGNvZGVWZXJzaW9uID0ge21ham9yOiA2LCB2ZXJzaW9uU3RyaW5nOiAnNi4wLjAnfTtcbiAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRWZXJzaW9uJykuYXRMZWFzdCgxKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSh4Y29kZVZlcnNpb24pKTtcblxuICAgICAgbGV0IHNpbXMgPSBbXG4gICAgICAgIGdldFNpbXVsYXRvcignRjMzNzgzQjItOUVFOS00QTk5LTg2NkUtRTEyNkFEQkFENDEwJyksXG4gICAgICAgIGdldFNpbXVsYXRvcignREZCQzI5NzAtOTQ1NS00RkQ5LUJCNjItOUU0QUU1QUE2OTU0JyksXG4gICAgICBdO1xuXG4gICAgICBsZXQgc3RhdHMgPSBzaW1zLm1hcCgoc2ltUHJvbSkgPT4ge1xuICAgICAgICByZXR1cm4gc2ltUHJvbS50aGVuKChzaW0pID0+IHtcbiAgICAgICAgICByZXR1cm4gc2ltLnN0YXQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgc3RhdHMgPSBhd2FpdCBCLmFsbChzdGF0cyk7XG5cbiAgICAgIHN0YXRzWzBdLnN0YXRlLnNob3VsZC5lcXVhbCgnU2h1dGRvd24nKTtcbiAgICAgIHN0YXRzWzBdLm5hbWUuc2hvdWxkLmVxdWFsKCdSZXNpemFibGUgaVBob25lJyk7XG4gICAgICBzdGF0c1sxXS5zdGF0ZS5zaG91bGQuZXF1YWwoJ1NodXRkb3duJyk7XG4gICAgICBzdGF0c1sxXS5uYW1lLnNob3VsZC5lcXVhbCgnUmVzaXphYmxlIGlQYWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cblxuICBkZXNjcmliZSgnZ2V0RGV2aWNlU3RyaW5nJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdYY29kZSA2JywgKCkgPT4ge1xuICAgICAgbGV0IHhjb2RlVmVyc2lvbiA9IHttYWpvcjogNiwgdmVyc2lvblN0cmluZzogJzYuMC4wJ307XG5cbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0VmVyc2lvbicpLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHhjb2RlVmVyc2lvbikpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgZ2V0IHRoZSBjb3JyZWN0IGRldmljZSBmb3IgaU9TIDgrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0TWF4SU9TU0RLJykucmV0dXJucyhQcm9taXNlLnJlc29sdmUoOC40KSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoKTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDYgKDguNCBTaW11bGF0b3IpJyk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgZ2V0IHRoZSBjb3JyZWN0IGRldmljZSBmb3IgaU9TIDgrIHdoZW4gcGxhdGZvcm0gdmVyc2lvbiBwYXNzZWQgaW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoe3BsYXRmb3JtVmVyc2lvbjogJzguMSd9KTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDYgKDguMSBTaW11bGF0b3IpJyk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgZ2V0IHRoZSBjb3JyZWN0IGRldmljZSBmb3IgaU9TIDcrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0TWF4SU9TU0RLJykucmV0dXJucyhQcm9taXNlLnJlc29sdmUoNy4xKSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoKTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDVzICg3LjEgU2ltdWxhdG9yKScpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIGdldCB0aGUgY29ycmVjdCBkZXZpY2UgZm9yIGlPUyA3KyB3aGVuIHBsYXRmb3JtIHZlcnNpb24gcGFzc2VkIGluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgZGV2aWNlID0gYXdhaXQgZ2V0RGV2aWNlU3RyaW5nKHtwbGF0Zm9ybVZlcnNpb246ICc3LjEnfSk7XG4gICAgICAgIGRldmljZS5zaG91bGQuZXF1YWwoJ2lQaG9uZSA1cyAoNy4xIFNpbXVsYXRvciknKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBwYXNzIHRocm91Z2ggZGV2aWNlIG5hbWUgd2hlbiBwYXNzZWQgd2l0aCA9JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0TWF4SU9TU0RLJykucmV0dXJucyhQcm9taXNlLnJlc29sdmUoOC40KSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoe2RldmljZU5hbWU6ICc9ZmFuY3kgZGV2aWNlJ30pO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdmYW5jeSBkZXZpY2UnKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBhZGQgYSBkZXZpY2UgbmFtZSB3aGVuIHBhc3NlZCB3aXRob3V0ID0nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRNYXhJT1NTREsnKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSg4LjQpKTtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IGdldERldmljZVN0cmluZyh7ZGV2aWNlTmFtZTogJ2ZhbmN5IGRldmljZSd9KTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnZmFuY3kgZGV2aWNlICg4LjQgU2ltdWxhdG9yKScpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSBzdHJpbmcgcGxhdGZvcm0gdmVyc2lvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldE1heElPU1NESycpLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKCc4LjQnKSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoKTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDYgKDguNCBTaW11bGF0b3IpJyk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgc3RyaXAgXCIgU2ltdWxhdG9yXCIgd2hlbiBub3QgbmVjZXNzYXJ5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0TWF4SU9TU0RLJykucmV0dXJucyhQcm9taXNlLnJlc29sdmUoJzguNCcpKTtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IGdldERldmljZVN0cmluZyh7ZGV2aWNlTmFtZTogXCJpUGhvbmUgNiBTaW11bGF0b3JcIn0pO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdpUGhvbmUgNiAoOC40IFNpbXVsYXRvciknKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgYmFyZSBcImlQaG9uZVwiJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0TWF4SU9TU0RLJykucmV0dXJucyhQcm9taXNlLnJlc29sdmUoJzguNCcpKTtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IGdldERldmljZVN0cmluZyh7ZGV2aWNlTmFtZTogXCJpUGhvbmVcIn0pO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdpUGhvbmUgNiAoOC40IFNpbXVsYXRvciknKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1hjb2RlIDcnLCAoKSA9PiB7XG4gICAgICBsZXQgeGNvZGVWZXJzaW9uID0ge21ham9yOiA3LCB2ZXJzaW9uU3RyaW5nOiAnNy4wLjAnfTtcblxuICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRWZXJzaW9uJykucmV0dXJucyhQcm9taXNlLnJlc29sdmUoeGNvZGVWZXJzaW9uKSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBnZXQgdGhlIGNvcnJlY3QgZGV2aWNlIGZvciBpT1MgOCsnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRNYXhJT1NTREsnKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSg4LjQpKTtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IGdldERldmljZVN0cmluZygpO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdpUGhvbmUgNiAoOC40KScpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIGdldCB0aGUgY29ycmVjdCBkZXZpY2UgZm9yIGlPUyA4KyB3aGVuIHBsYXRmb3JtIHZlcnNpb24gcGFzc2VkIGluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgZGV2aWNlID0gYXdhaXQgU2ltdWxhdG9yWGNvZGU3LmdldERldmljZVN0cmluZyh7cGxhdGZvcm1WZXJzaW9uOiAnOC4xJ30pO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdpUGhvbmUgNiAoOC4xKScpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIGdldCB0aGUgY29ycmVjdCBkZXZpY2UgZm9yIGlPUyA5KycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldE1heElPU1NESycpLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKDkpKTtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IGdldERldmljZVN0cmluZygpO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdpUGhvbmUgNiAoOS4wKSBbJyk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgZ2V0IHRoZSBjb3JyZWN0IGRldmljZSBmb3IgaU9TIDkrIHdoZW4gcGxhdGZvcm0gdmVyc2lvbiBwYXNzZWQgaW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoe3BsYXRmb3JtVmVyc2lvbjogJzkuMCd9KTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDYgKDkuMCkgWycpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIHBhc3MgdGhyb3VnaCBkZXZpY2UgbmFtZSB3aGVuIHBhc3NlZCB3aXRoID0nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRNYXhJT1NTREsnKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSg5LjApKTtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IGdldERldmljZVN0cmluZyh7ZGV2aWNlTmFtZTogJz1mYW5jeSBkZXZpY2UnfSk7XG4gICAgICAgIGRldmljZS5zaG91bGQuZXF1YWwoJ2ZhbmN5IGRldmljZScpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIGFkZCBhIGRldmljZSBuYW1lIHdoZW4gcGFzc2VkIHdpdGhvdXQgPScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldE1heElPU1NESycpLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKDkuMCkpO1xuICAgICAgICBsZXQgZGV2aWNlID0gYXdhaXQgZ2V0RGV2aWNlU3RyaW5nKHtkZXZpY2VOYW1lOiAnZmFuY3kgZGV2aWNlJ30pO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdmYW5jeSBkZXZpY2UgKDkuMCknKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBzdHJpcCBcIiBTaW11bGF0b3JcIiB3aGVuIG5vdCBuZWNlc3NhcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRNYXhJT1NTREsnKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSgnOS4wJykpO1xuICAgICAgICBsZXQgZGV2aWNlID0gYXdhaXQgZ2V0RGV2aWNlU3RyaW5nKHtkZXZpY2VOYW1lOiBcImlQaG9uZSA2IFNpbXVsYXRvclwifSk7XG4gICAgICAgIGRldmljZS5zaG91bGQuZXF1YWwoJ2lQaG9uZSA2ICg5LjApIFsnKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgYmFyZSBcImlQaG9uZVwiJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0TWF4SU9TU0RLJykucmV0dXJucyhQcm9taXNlLnJlc29sdmUoJzkuMCcpKTtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IGdldERldmljZVN0cmluZyh7ZGV2aWNlTmFtZTogXCJpUGhvbmVcIn0pO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdpUGhvbmUgNiAoOS4wKSBbJyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
